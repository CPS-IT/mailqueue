<html xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
      xmlns:m="http://typo3.org/ns/CPSIT/Typo3Mailqueue/ViewHelpers"
      data-namespace-typo3-fluid="true">

<tr class="{f:render(section: 'rowClass', arguments: {state: queueItem.state}) -> f:spaceless()}">
    <td class="col-icon align-top">
        <f:switch expression="{queueItem.state.value}">
            <f:case value="failed">
                <span class="badge badge-danger d-block">{f:translate(key: 'queueItem.state.failed', extensionName: 'Mailqueue')}</span>
            </f:case>
            <f:case value="queued">
                <f:if condition="{queueItem.date} && {queueItem.date -> m:dateInterval()} >= 1800">
                    <f:then>
                        <span class="badge badge-warning d-block">{f:translate(key: 'queueItem.state.late', extensionName: 'Mailqueue')}</span>
                    </f:then>
                    <f:else>
                        <span class="badge badge-primary d-block">{f:translate(key: 'queueItem.state.queued', extensionName: 'Mailqueue')}</span>
                    </f:else>
                </f:if>
            </f:case>
            <f:case value="sending">
                <f:if condition="{queueItem.date} && {queueItem.date -> m:dateInterval()} >= 1800">
                    <f:then>
                        <span class="badge badge-warning d-block">{f:translate(key: 'queueItem.state.late', extensionName: 'Mailqueue')}</span>
                    </f:then>
                    <f:else>
                        <span class="badge badge-warning d-block">{f:translate(key: 'queueItem.state.sending', extensionName: 'Mailqueue')}</span>
                    </f:else>
                </f:if>
            </f:case>
            <f:defaultCase>
                <span class="badge badge-notice d-block">{f:translate(key: 'queueItem.state.unknown', extensionName: 'Mailqueue')}</span>
            </f:defaultCase>
        </f:switch>
    </td>
    <td class="align-top">
        <f:if condition="{queueItem.date}">
            <time datetime="{queueItem.date -> f:format.date(format: 'Y-m-d\TH:i:s.vP')}"
                  title="{queueItem.date -> f:format.date(format: 'Y-m-d H:i:s')}"
            >
                {queueItem.date -> m:format.humanDate()}
            </time>
        </f:if>
    </td>
    <td class="align-top">
        <f:if condition="{queueItem.message.message.subject}">
            <f:then>
                {queueItem.message.message.subject}
            </f:then>
            <f:else if="{queueItem.message.originalMessage.subject}">
                {queueItem.message.originalMessage.subject}
            </f:else>
            <f:else>
                <em>{f:translate(key: 'queueItem.subject.unknown', extensionName: 'Mailqueue')}</em>
            </f:else>
        </f:if>
    </td>
    <td class="align-top">
        <f:for each="{queueItem.message.envelope.recipients}" as="recipient">
            <f:render partial="Mail/Address" arguments="{address: recipient}" /><br>
        </f:for>
    </td>
    <td class="align-top">
        <f:render partial="Mail/Address" arguments="{address: queueItem.message.envelope.sender}" />
    </td>
</tr>

<f:section name="rowClass">
    <f:switch expression="{state.value}">
        <f:case value="failed">danger</f:case>
        <f:case value="sending">warning</f:case>
    </f:switch>
</f:section>

</html>
